# -*- coding: utf-8 -*-
"""Bank_Marketing_Dataset

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/119eOOQeTvVIuBHeKEfNY70JgE0_2g6uS
"""

import seaborn as sns
import pandas as pd
import numpy as np
import warnings
warnings.filterwarnings('ignore')

!pip install seaborn
from google.colab import files
uploaded = files.upload()

# ==============================
# 1. IMPORT LIBRARIES
# ==============================
import pandas as pd
import numpy as np
import warnings
warnings.filterwarnings('ignore')

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from sklearn.tree import DecisionTreeClassifier
from sklearn.metrics import confusion_matrix, classification_report, accuracy_score

# ==============================
# 2. LOAD DATASET
# ==============================
from google.colab import files
uploaded = files.upload()

df = pd.read_csv("bank_marketing_dataset.csv", sep=",") # Corrected separator to ","

# ==============================
# 3. HANDLE MISSING VALUES
# ==============================
# Fill numeric columns with MEAN
num_cols = df.select_dtypes(include=np.number).columns
df[num_cols] = df[num_cols].fillna(df[num_cols].mean())

# Fill categorical columns with MODE (mean doesn't apply to text)
cat_cols = df.select_dtypes(include='object').columns
for col in cat_cols:
    df[col] = df[col].fillna(df[col].mode()[0])

# ==============================
# 4. FEATURE SELECTION
# ==============================
features = ['age','job','balance','loan','contact','duration','campaign']
target = 'deposit' # Corrected target column name to 'deposit'

data = df[features + [target]].copy()

# ==============================
# 5. ENCODING CATEGORICAL DATA
# ==============================
le = LabelEncoder()

for col in ['job','loan','contact']:
    data[col] = le.fit_transform(data[col])

data[target] = data[target].map({'yes':1,'no':0})

X = data[features]
y = data[target]

# ==============================
# 6. TRAIN-TEST SPLIT
# ==============================
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# ==============================
# 7. DECISION TREE MODEL
# ==============================
model = DecisionTreeClassifier(
    criterion="gini",
    max_depth=5,
    random_state=42
)

model.fit(X_train, y_train)

from sklearn.tree import plot_tree
import matplotlib.pyplot as plt

plt.figure(figsize=(22,10))

plot_tree(
    model,
    feature_names=features,
    class_names=["Not Subscribe", "Subscribe"],
    filled=True,
    rounded=True
)

plt.title("Decision Tree Visualization for Term Deposit Prediction")
plt.show()

# ==============================
# 8. PREDICTION
# ==============================
y_pred = model.predict(X_test)

# ==============================
# 9. CONFUSION MATRIX & METRICS
# ==============================
cm = confusion_matrix(y_test, y_pred)

print("Confusion Matrix:\n", cm)
print("\nAccuracy:", accuracy_score(y_test, y_pred))
print("\nClassification Report:\n", classification_report(y_test, y_pred))



# ==============================
# NEW CUSTOMER PREDICTION
# ==============================

# Example new customer details
# age, job, balance, loan, contact, duration, campaign

new_customer = pd.DataFrame([{
    "age": 32,
    "job": "technician",
    "balance": 1800,
    "loan": "no",
    "contact": "cellular",
    "duration": 250,
    "campaign": 2
}])

# Encode categorical values (same encoding logic)
new_customer["job"] = le.fit_transform(new_customer["job"])
new_customer["loan"] = le.fit_transform(new_customer["loan"])
new_customer["contact"] = le.fit_transform(new_customer["contact"])

# Predict
prediction = model.predict(new_customer)[0]

# Output
if prediction == 1:
    print("Prediction: Customer is LIKELY to subscribe to term deposit")
else:
    print("Prediction: Customer is NOT likely to subscribe to term deposit")

